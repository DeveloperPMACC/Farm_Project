<%- contentFor('body') %>

  <div id="dashboard-section" class="content-section active">
    <h2>Dashboard</h2>

    <div class="row mt-4">
      <div class="col-md-3">
        <div class="card text-white bg-primary">
          <div class="card-body">
            <h5 class="card-title">Dispositivos</h5>
            <p class="card-text display-4" id="devices-count">
              <%= stats.devicesCount %>
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card text-white bg-success">
          <div class="card-body">
            <h5 class="card-title">Tareas</h5>
            <p class="card-text display-4" id="tasks-count">
              <%= stats.tasksCount %>
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card text-white bg-warning">
          <div class="card-body">
            <h5 class="card-title">Tiempo Total</h5>
            <p class="card-text display-4" id="total-time">
              <%= formatTime(stats.totalViewTime) %>
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card text-white bg-danger">
          <div class="card-body">
            <h5 class="card-title">Interacciones</h5>
            <p class="card-text display-4" id="interactions-count">
              <%= stats.totalInteractions %>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Actividad Reciente</h5>
          </div>
          <div class="card-body">
            <div id="activity-table">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Dispositivo</th>
                    <th>App</th>
                    <th>Tiempo</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="activity-table-body">
                  <% if (stats.recentActivity && stats.recentActivity.length> 0) { %>
                    <% stats.recentActivity.forEach(function(activity) { %>
                      <tr>
                        <td>
                          <%= activity.device ? activity.device.name : 'Desconocido' %>
                        </td>
                        <td>
                          <%= activity.app ? activity.app.name : 'Desconocida' %>
                        </td>
                        <td>
                          <%= formatTime(activity.viewTime) %>
                        </td>
                        <td><span class="badge bg-success">Completado</span></td>
                      </tr>
                      <% }); %>
                        <% } else { %>
                          <tr>
                            <td colspan="4" class="text-center">No hay actividad reciente</td>
                          </tr>
                          <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Estadísticas por App</h5>
          </div>
          <div class="card-body">
            <canvas id="apps-chart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Datos para el gráfico
      const appsChartData = <% - JSON.stringify(stats.appsChartData) %>;
      initializeAppsChart(appsChartData);
    });
  </script>